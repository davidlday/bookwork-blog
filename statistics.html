---
layout: page
title: Statistics
comments: false
jquery: true
flot: true
bookwormjs: true
---

        <style>
        table {
            width: auto;
        }
        </style>

        <div id="loading_message" style="width: 100%;">
        Loading data...
        </div>
        <div id="legend"></div>
        <div id="magazine_dashboard" style="width: 100%; display: none;">
            <div id="magazine_selector" class="font-62"></div>
            <hr />
        </div>

        <script>

            var display_results = bwconfig.display_results;
            //var display_results = ['pov'];
            var magazines = [];
            var magazine_datatable;
            var magazine_selector;
            var magazine_dashboard;

            var chart_data = {};
            var charts = {};
            var options = {
                series: {
                    stack: true,
                    lines: {
                        show: false,
                        fill: true,
                        steps: false,
                    },
                    bars: {
                        align: 'center',
                        show: true,
                        barWidth: 0.25,
                        lineWidth: 0,
                        fill: 0.9,
                    },
                },
//                 legend: {
//                     container: $('#legend'),
//                 },
            };

            function loadDataAndDraw( binneddata ) {
                // Add result to data;
                var new_data = [];
                $.each( binneddata.bins, function(index, data) {
                    new_data.push( [data.bin, data.count] );
                });
                chart_data[binneddata.metric].push( {
                    label: binneddata.magazine,
                    hoverable: true,
                    clickable: true,
                    data: new_data,
                });

                options.series.bars.barWidth = binneddata.binsize * 0.8;
                options['xaxis'] = binneddata.xaxis;

                $.plot('#histogram_' + binneddata.metric, chart_data[binneddata.metric], options);

                // Now show the whole thing
                $('#loading_message').hide();
                $('#magazine_dashboard').show();

            }

            $(document).ready( function() {
                //Create initial charts
                var div_width = $('#magazine_dashboard').parent().width()
                var div_height = (div_width * 2) / 3;
                $.each( display_results, function( metric_index, metric ) {
                    // Initialize data sets
                    chart_data[metric] = [];
                    // Add div for the chart
                    $('#magazine_dashboard').append("<h2>" + getFieldLabel(metric) + "</h2>" +
                        "<div id=\"histogram_" + metric +
                        "\" style=\"width: " + div_width + "px; height: " + div_height +
                        "px;\"></div>" +
                        "<div id=\"histogram_" + metric + "_legend\"></div>" +
                        "<hr />");


                    solrGetMagazines( function( magazines ) {
                        $.each( magazines, function( index, magazine ) {
                            solrGetBinnedMetric(magazine.name,
                                metric,
                                function( binneddata ) {
                                    loadDataAndDraw( binneddata );
                                },
                                logAjaxError);
                        });
                    }, logAjaxError);
                });

            });
        </script>

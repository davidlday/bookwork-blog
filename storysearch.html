---
layout: page
title: Story Search
comments: false
jquery: true
---

        <style>
        .result p {
            font-size: 75%;
        }
        </style>
        <div id="search">
            <form id="searchForm" action="http://bookworm.davidlday.com/public/scripts/storysearch.py" >
                <input id="searchText" type="text" style="width: 100%" placeholder="Search Stories..." />
            </form>
        </div>
        <div id="searchStats">
        </div>
        <div id="results">
        </div>

        <script>
            var thread = null;

            function searchStories(query) {
                // Wipe out prior results
                $('#results').empty();
                $('#searchStats').empty();
                $('#searchStats').append("Searching...");
                var url = 'http://bookworm.davidlday.com/public/scripts/storysearch.py';
                var date_options = {year: "numeric", month: "long", day: "numeric"};

                // Invoke search
                $.post(url,
                    {q: query, wt: 'json', fl: '*,score', rows: '999999999'},
                    function(data) {
                        // Update results stats
                        $('#searchStats').empty();
                        $('#searchStats').append(
                            "Found " + data.response.numFound + " stories.<hr />"
                        );
                        // Add results
                        $.each(data.response.docs, function(index, doc) {
                            var published_date = new Date(doc.pub_date);

                            $('#results').append(
                                "<div class=\"result\">" +
                                "<a href=\"" + doc.url + "\" target=\"_blank\">" + doc.magazine + " >> " + doc.title + "</a>" +
                                "<p>" + doc.url + "<br />" +
                                "By " + doc.author.join(", ") + "<br />" +
                                "Published " + published_date.toLocaleDateString('en-us', date_options) + "<br />" +
                                "Word Count: " + doc.word_count + "<br />" +
                                "Search Relevance: " + doc.score +
                                "</p></div><hr />"
                            );
                        });
                    },
                    'json'
                );

            }

            $('#searchText').keyup(function() {
              clearTimeout(thread);
              var $this = $(this);
              thread = setTimeout(function(){searchStories($this.val())}, 500);
            });

            /* attach a submit handler to the form */
            $("#searchForm").submit(function(event) {
                // Prevent default form submission
                event.preventDefault();
                searchStories($( '#searchText').val());
            });
        </script>
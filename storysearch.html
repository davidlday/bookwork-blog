---
layout: page
title: Story Search
comments: false
jquery: true
bookwormjs: true
---

        <style>
        .result p {
            font-size: 75%;
        }
        </style>
        <div id="search">
            <form id="searchForm" action="http://bookworm.davidlday.com/public/scripts/storysearch.py" >
                <input id="searchText" type="text" style="width: 100%" placeholder="Search Stories..." />
            </form>
        </div>
        <div id="searchStats">
        </div>
        <div id="results">
        </div>

        <script>
            // Controls what metrics are displayed.
            var display_results = [
                'syllable_count',
                'word_count',
                'sentence_count',
                'avg_syllables_per_word',
                'avg_words_per_sentence',
                'dialogue_word_percentage',
                'pov',
                'coleman_liau_index',
                'automated_readability_index',
                'flesch_kincaid_grade_level',
                'smog_index',
                'flesch_reading_ease',
                'gunning_fog_index',
                'rix',
                'lix',
            ];

            var thread = null;

            function displayResults(data) {
                // Update results stats
                $('#searchStats').empty();
                $('#searchStats').append(
                    "Found " + data.response.numFound + " stories.<hr />"
                );
                var res_counter = 1;
                var date_options = {year: "numeric", month: "long", day: "numeric"};

                // Add results
                $.each(data.response.docs, function(index, doc) {
                    var published_date = new Date(doc.pub_date);

                    // Generate metrics string
                    var metrics_display = '';
                    $.each(display_results, function(metric) {
                        metrics_display += "&nbsp;&nbsp;" + bookworm_labels[metric] + ": " + doc[metric] + "<br />";
                    });

                    $('#results').append(
                        "<div class=\"result\" id=\"res-" + res_counter + "\">" +
                        res_counter + ".&nbsp;<a href=\"" + doc.url + "\" target=\"story\">" +
                        doc.magazine + " >> " + doc.title + "</a>" +
                        "<p>" + doc.url + "<br />" +
                        "By " + doc.author.join(", ") + "<br />" +
                        "Published " + published_date.toLocaleDateString('en-us', date_options) + "<br />" +
                        "Search Relevance: " + doc.score + "<br />" +
//                        "<div class=\"toggler\">Show More Like This" +
//                        "<div class=\"mlt\" id=\"mlt-" + res_counter + "\">More Like This</div>" +
//                        "</div>"+
                        "</p></div>" +
                        "<hr />"
                    );

//                    $('#mlt-' + res_counter).hide()

                    res_counter += 1;
                });
//                $('div.toggler').click(function() {
//                    $(this).children().each( function() {
//                        $(this).toggle();
//                    });
//                });
            }

            function searchStories(query, callbackName) {
                // Wipe out prior results
                $('#results').empty();
                $('#searchStats').empty();
                $('#searchStats').append("Searching...");
                var params = 'q=' + query + '&wt=json&fl=*,score&rows=999999999';
                searchBookworm(params, 'displayResults');
            }

            $('#searchText').keyup(function() {
              clearTimeout(thread);
              var $this = $(this);
              thread = setTimeout(function(){searchStories($this.val())}, 500);
            });

            /* attach a submit handler to the form */
            $('#searchForm').submit(function(event) {
                // Prevent default form submission
                event.preventDefault();
                searchStories($('#searchText').val());
            });
        </script>
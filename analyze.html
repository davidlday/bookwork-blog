---
layout: page
title: Analyzer
comments: false
jquery: true
bookwormjs: true
---

<!--
TODO:
* Make tips into an accordion
* Use labels from bookworm_labels in bookworm.js
* Extract Similar Stories and Bookworm Analysis into bookworm.js for use in search as well.
-->


        <p>Use this form to analyze a piece of writing with the same algorithms I use. Some important points:</p>
        <ul>
            <li>Nothing from this is saved anywhere. Not the story; not the results. If you want to save your results, write them down or print the page.</li>
            <li>Plain text only.</li>
            <li>Everything between double quotes (") is considered dialogue.</li>
            <li>Section separators (e.g. #) are ignored. Actually, this isn't important right now, but may be at some point.</li>
            <li>Paragraphs are separated by a line breaks (return). Multiple consecutive line breaks are considered as one.</li>
            <li>The formulae for the readability scores vary. What you get here may not exactly match what you get somewhere else, but it's close enough.</li>
        </ul>

        <div id="story">
            <textarea id="storyText" class="storyText" placeholder="Paste story here..."></textarea>
            <button id="analyzeButton">Analyze</button>
        </div>
        <div id="results-message" style="display: none;">Running Bookworm analysis and searching for similar stories...</div>
        <div id="results" class="accordion font-75" style="display: none;">
            <h3>Bookworm Analysis</h3>
            <table class="scrollTable" cellpadding="0" cellspacing="0" border="0" id="analysisTable">
                <thead id="analysisTableHead">
                    <tr><td>Metric</td><td>Value</td></tr>
                </thead>
                <tbody id="analysisTableBody">
                </tbody>
            </table>
            <h3>Similar Stories</h2>
            <table class="scrollTable" cellpadding="0" cellspacing="0" border="0" id="mltTable">
                <thead id="mltTableHead">
                    <tr><td>Title</td><td>Author</td><td>Magazine</td><td>Published Date</td></tr>
                </thead>
                <tbody id="mltTableBody">
                </tbody>
            </table>
        </div>

        <script>
            // Controls what return values are displayed in the table.
            var display_results = {
                syllable_count: "Total Syllable Count",
                word_count: "Total Word Count",
                sentence_count: "Total Sentence Count",
                avg_syllables_per_word: "Avg. Syllables per Word",
                avg_words_per_sentence: "Avg. Words per Sentence",

                dialogue_syllable_count: "Dialogue Syllable Count",
                dialogue_word_count: "Dialogue Word Count",
                narrative_syllable_count: "Narrative Syllable Count",
                narrative_word_count: "Narrative Word Count",
                dialogue_syllable_percentage: "Percent Dialogue (Syllables)",
                dialogue_word_percentage: "Percent Dialogue (Words)",

                pov: "Point of View",

                coleman_liau_index: "Readability: Coleman Liau Index",
                automated_readability_index: "Readability: Automated Readability Index",
                flesch_kincaid_grade_level: "Readability: Flesch Kincaid Grade Level",
                smog_index: "Readability: SMOG Index",
                flesch_reading_ease: "Readability: Flesch Reading Ease",
                gunning_fog_index: "Readability: Gunning Fog Index",
                rix: "Readability: RIX",
                lix: "Readability: LIX",
            };

            // Search button
            $('#analyzeButton').click( analyzeStory );

            // Local function to analyze the story
            function analyzeStory() {
                $('#mlt-message').show();
                $('#mlt').hide();
                $('#results-message').show();
                $('#results').hide();

                // Wipe out prior results
                $('#analysisTableBody').empty();
                $('#mltTableBody').empty();

                // Make sure there's text and run analysis
                var story = $('#storyText').val();
                if (story != null && story != '') {
                    analyzeText(story, displayAnalysis, displayAjaxError);
                    solrMoreLikeThisText(story, displaySimilarStories, displayAjaxError);
                }
            }

            function displayAnalysis(data) {
                // Add results to summary table
                $.each(display_results, function(key, value) {
                    $('#analysisTableBody').append(
                        "<tr id=\"" + key + "\">" +
                        "<td>" + value + "</td>" +
                        "<td>" + data[key] + "</td>" +
                        "</tr>"
                    );
                });
                // Collapse all accordions.
                $( "div.accordion" ).each( function() {
                    $(this).accordion({
                        active: 0,
                        collapsible: true,
                        animate: 50,
                    });
                });

                // Show the results div
                $('#results-message').hide();
                $('#results').show();
            }

            // Show similar stories
            function displaySimilarStories(data) {
                // Add stories to mlt table
                $.each(data.response.docs, function(index, doc) {
                    var published_date = new Date(doc.pub_date);
                    $('#mltTableBody').append(
                        "<tr id=\"mlt-" + index + "\">" +
                        "<td><a href=\"" +doc.url + "\" target=\"story\">" + doc.title + "</a></td>" +
                        "<td>" + doc.author.join() + "</td>" +
                        "<td>" + doc.magazine + "</td>" +
                        "<td>" + published_date.toLocaleDateString('en-us', date_options) + "</td>" +
                        "</tr>"
                    );
                });
            }

            // Log Ajax Error
            function displayAjaxError(thrownMessage) {
                console.log(thrownMessage);
            }

            /* attach a submit handler to the form */
//             $("#analysisForm").submit(function(event) {
//                 // Prevent default form submission
//                 event.preventDefault();
//
//                 // Wipe out prior results
//                 $('#analysisTableBody').empty();
//
//                 var story = $( 'textarea#storyText').val();
//                 var url = $(this).attr('action');
//
//                 // Invoke analysis
//                 $.post(url,
//                     {text: story},
//                     function(data) {
//                         // Add results to summary table
//                         $.each(display_results, function(key, value) {
//                             $('#analysisTableBody').append(
//                                 "<tr id=\"" + key + "\">" +
//                                 "<td>" + value + "</td>" +
//                                 "<td>" + data[key] + "</td>" +
//                                 "</tr>"
//                             );
//                         });
//                     },
//                     'json'
//                 );
//
//             });
        </script>
